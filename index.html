<html>
<head>
        <meta charset="utf-8" />
		
		
        <title>CATNAT</title>
		 
		  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
		  

		  <!-- CSS  -->
		  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		  <link href="materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
		  <link href="nouislider.css" type="text/css" rel="stylesheet" media="screen,projection"/>
		  
		  <script src="https://d3js.org/d3.v4.min.js"></script>
		  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	</head>
<body>
<div>
	<div class="title-color center"><h4>Natural Disasters</h4></div>
    <div class="row" style="margin-bottom:0;">
	<div class="col s2" id="disasterpanel">
		<div id="buttondisaster" >
			<div class="button" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcat" ><img class="typecat" name="Drought" src="drought.png"  onclick="change(event,'Drought')" width="40px"/></div>
				<div class="detailstype" id="detailstypeDrought" style="background-color:#ff7b7b;width:150px;"><p style="margin:0;padding-top:10px;"><span id="data_drought"></span></p></div>
			</div>
			<div class="button" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcat" ><img class="typecat" name="Earthquake" src="earthquake.png" onclick="change(event,'Earthquake')" width="40px"/></div>
				<div class="detailstype" id="detailstypeDrought" style="background-color:#dab58f;width:170px;"><p style="margin:0;padding-top:10px;"><span id="data_earthquake"></span></p></div>
			</div>
			<div class="button" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcat" ><img class="typecat" name="Extreme temperature " src="extremetemperature.png" onclick="change(event,'Extreme temperature')" width="40px" /></div>
				<div class="detailstype" id="detailstypeDrought" style="background-color:#d4dff1;width:230px;"><p style="margin:0;padding-top:10px;"><span id="data_dry"></span></p></div>
			</div>
			<div class="button" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcat" ><img class="typecat" name="Storm" src="storm.png" onclick="change(event,'Storm')" width="40px"/></div>
				<div class="detailstype" id="detailstypeDrought" style="background-color:#ffe187;width:130px;"><p style="margin:0;padding-top:10px;"><span id="data_storm"></span></p></div>
			</div>
			<div class="button" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcat" ><img class="typecat" name="Wildfire" src="wildfire.png" onclick="change(event,'Wildfire')" width="40px"/></div>
				<div class="detailstype" id="detailstypeDrought" style="background-color:#00d660;width:150px;"><p style="margin:0;padding-top:10px;"><span id = "data_wildfire"></span></p></div>
			</div>
			<div class="button" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcat" ><img class="typecat" name="Volcanic activity" src="volcano.png" onclick="change(event,'Volcanic activity')" width="40px"/></div>
				<div class="detailstype" id="detailstypeDrought" style="background-color:#f2a36f;width:200px;"><p style="margin:0;padding-top:10px;"><span id = "data_volcanic"></span></p></div>
			</div>
		</div>
	</div>
	<div  id="continentpanel">
		<div id="buttonContinent" >
			<div class="button2" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcont" ><img class="typecont" name="Europe" src="europe.png"  onclick="change(event,'Europe')" width="40px"/></div>
				<div class="detailscont"  style="background-color:lightgrey;width:150px;left:-110px;"><p style="margin:0;padding-top:10px;"><span id = "data_europe"></span></p></div>
			</div>
			<div class="button2" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcont" ><img class="typecont" name="North America" src="northamerica.png" onclick="change(event,'North America')" width="40px"/></div>
				<div class="detailscont"  style="background-color:lightgrey;width:200px;left:-160px;"><p style="margin:0;padding-top:10px;"><span id = "data_north_am"></span></p></div>
			</div>
			<div class="button2" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcont" ><img class="typecont" name="South America" src="southamerica.png" onclick="change(event,'South America')" width="40px" /></div>
				<div class="detailscont"  style="background-color:lightgrey;width:200px;left:-160px;"><p style="margin:0;padding-top:10px;"><span id = "data_south_am"></span></p></div>
			</div>
			<div class="button2" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcont" ><img class="typecont" name="Oceania" src="oceania.png" onclick="change(event,'Oceania')" width="40px"/></div>
				<div class="detailscont" style="background-color:lightgrey;width:150px;left:-110px;"><p style="margin:0;padding-top:10px;"><span id = "data_oceania"></span></p></div>
			</div>
			<div class="button2" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcont" ><img class="typecont" name="Asia" src="asia.png" onclick="change(event,'Asia')" width="40px"/></div>
				<div class="detailscont"  style="background-color:lightgrey;width:130px;left:-90px;"><p style="margin:0;padding-top:10px;"><span id = "data_asia"></span></p></div>
			</div>
			<div class="button2" onmouseover="displayinfo(this)" onmouseout="hideinfo(this)">
				<div class="iconcont" ><img class="typecont" name="Africa" src="africa.png" onclick="change(event,'Africa')" width="40px"/></div>
				<div class="detailscont"  style="background-color:lightgrey;width:150px;left:-110px;"><p style="margin:0;padding-top:10px;"><span id = "data_africa"></span></p></div>
			</div>
			
		</div>
	</div>
   			<div class="col s12 main" >
   				<div id="svgcontainer"></div>
   				
   			</div>
   			
   			<div class="col s12 row" id="selectpanel" >
   			<div id="onoff" onclick="displayhide()">
   				<i class="small material-icons" id="moreless">expand_more</i>
   				</div>
   			
   			<div class="col s12 content" style="margin-top:0px">
   				<div id="test-slider" style="color:white;"></div>
   				<div id="svgcontainerbottom" style="margin-bottom:20px"></div>
   				</div>
   				</div>
   </div>

</div>


 <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="materialize.js"></script>
  <script src="nouislider.js"></script>
  <script src="init.js"></script>
  <script src="wNumb.js"></script>
<script>

function displayinfo(elm){
	elm.getElementsByTagName('div')[1].style.display='block'
}
function hideinfo(elm){
	elm.getElementsByTagName('div')[1].style.display='none'
}

document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.tooltipped');
    var instances = M.Tooltip.init(elems);
  });
  
var debut=1900
var fin=2020

function filterPips(value, type) {
    return value % 10==0 ? 2 : 0;
}

var slider = document.getElementById('test-slider');
noUiSlider.create(slider, {
 start: [1900, 2019],
 
 connect: true,
 step: 1,
 orientation: 'horizontal', // 'horizontal' or 'vertical'
 
 range: {
   'min': debut,
   'max': fin
 },
   format: wNumb({
     decimals: 0
   }),
   pips: {
       mode: 'steps',
       density: 3,
       filter: filterPips,
       format: wNumb({
           decimals: 0
       })
   }
   
});

var buttons =document.getElementsByClassName('noUi-touch-area')
slider.noUiSlider.on('update', function (values, handle, unencoded, tap, positions) {
   
    buttons[0].innerHTML='<p style="padding:0;margin:0;margin-top:8px;margin-left:4px;">'+values[0]+'</p>'
    buttons[1].innerHTML='<p style="padding:0;margin:0;margin-top:8px;margin-left:4px;">'+values[1]+'</p>'
});

slider.noUiSlider.on('end', function(values,handle,unencoded){
	debut=unencoded[0]
	fin=unencoded[1]
	filterpoints()
	filterlinegraph()
});

</script>
<script>
		var height = window.innerHeight -64;
		var mains=document.getElementsByClassName("main")
		for (var i = 0; i < mains.length; i++) {
			mains[i].style.height=height;
		
		}
		var hide=0;
		//function to hide or display the menu tool bar
		function displayhide(){
			if(hide==1)
				{
				var mains=document.getElementsByClassName("content")
				for (var i = 0; i < mains.length; i++) {
					mains[i].style.display='block';
				
					}
				document.getElementById('selectpanel').style.height='auto';
				document.getElementById('moreless').innerHTML='expand_more';
				hide=0
				}
			else{
				var mains=document.getElementsByClassName("content")
				for (var i = 0; i < mains.length; i++) {
					mains[i].style.display='none';
				
				}
				document.getElementById('selectpanel').style.height='0px';
				document.getElementById('moreless').innerHTML='expand_less';
				hide=1
			}
		}
  		
		//definition of all the svg containers
		var svg = d3.select( "#svgcontainer" )
  		.append( "svg" )
		  .attr( "height", height );
		
		var margin = {top:0, right:0, bottom:0, left:0};
	    var width = document.getElementById('svgcontainerbottom').offsetWidth-margin.right-margin.left,
	        height2 = 50-margin.top-margin.bottom;
		var svg2 = d3.select( "#svgcontainerbottom" )
  		.append( "svg" )
		  .attr( "height", height2 )
		.append("g")
	  	.attr("transform", "translate("+margin.left+","+margin.top+")")
	  	
	  	 	
	  	
    var projection = d3.geoNaturalEarth1();
    projection.center([60.454071, -13]).scale(140)

    var path = d3.geoPath() // d3.geo.path avec d3 version 3
                 .projection(projection);
    
 

	var simulation;
	  
	// Init graph data structure
	var graph = {nodes:[], links:[]};
	
	//definition gradient couleur for line chart bottom date
	var datagradient=[                             
        {offset: "0%", color: "red"}, 
        {offset: "100%", color: "red"}    
    ]
	var gradient= svg2.append("linearGradient")                
    .attr("id", "line-gradient")            
    .attr("gradientUnits", "userSpaceOnUse")    
    .attr("x1", "0%").attr("y1", 0)         
    .attr("x2", "100%").attr("y2", 0)
    gradient.selectAll("stop")                      
    .data(datagradient)
    .enter().append("stop")         
    .attr("offset", function(d) { return d.offset; })   
    .attr("stop-color", function(d) { return d.color; });
	
	
	var keys2=[]
	var nodes=[]
		// Load external data and boot
		

d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function(data){

	

    // Draw the map
    svg.append("g")
        .selectAll("path")
        .data(data.features)
        .enter().append("path")
            .attr("fill", "#69b3a2")
            .attr("d", path)
            .style("stroke", "#fff")
            .style("opacity", 0.6)
})
var couleurlist
    d3.csv("https://raw.githubusercontent.com/glegall7/datavizCATNAT/master/test6.csv", function(data){
      //console.log(data)
      d3.csv("https://raw.githubusercontent.com/glegall7/datavizCATNAT/master/couleur.csv", function(couleur){
      //console.log(couleur)
      d3.csv("https://raw.githubusercontent.com/glegall7/datavizCATNAT/master/liencatnat2.csv", function(error, datagraph) {

		update_number()

	var nested_data_continent = d3.nest()
		.key(function(d) { return d.continent; })
		.rollup(function(leaves) { return leaves.length; })
		.entries(data)
	

	var data_asia= document.getElementById("data_asia")
	data_asia.innerHTML = 'Asia : ' + nested_data_continent[0].value;

	var data_north_am= document.getElementById("data_north_am")
	data_north_am.innerHTML = 'North America : ' + nested_data_continent[1].value;

	var data_europe= document.getElementById("data_europe")
	data_europe.innerHTML = 'Europe : ' + nested_data_continent[3].value;

	var data_south_am= document.getElementById("data_south_am")
	data_south_am.innerHTML = 'South America : ' + nested_data_continent[4].value;

	var data_africa= document.getElementById("data_africa")
	data_africa.innerHTML = 'Africa : ' + nested_data_continent[5].value;

	var data_oceania= document.getElementById("data_oceania")
	data_oceania.innerHTML = 'Oceania : ' + nested_data_continent[6].value;
	

    	  couleurlist=couleur
   		//tracé graphique nb catastrophe par année
      var catbyyear = d3.nest()
		.key(function(d) { return d.year; })
		.rollup(function(leaves) { return leaves.length; })
		.entries(data);
      
      
      
      var x = d3.scaleTime()
        .domain(d3.extent(catbyyear,function(d){return d.key}))
        .range([0, width])

      var y = d3.scaleLinear()
        .domain([d3.min(catbyyear, function(d){return d.value}),
                 d3.max(catbyyear, function(d){return d.value})])
        .range([0,height2]);




        var line2 = d3.line()
        .curve(d3.curveMonotoneX)
        .x(function(d,i){return x(d.key)})
        .y(function(d,i){return 50-y(d.value);})

        
        var lines = svg2.append("g").selectAll("path").data([catbyyear]).enter()
        .append("path")
        .attr("d", line2)
        .attr("id", "line")
        .attr("fill", "none")
        .attr("stroke", "red")
        
        
      //fin tracé graphique cat/année
      
    	//graph liencatnat
    	
		
		  //fin liencatant
        
      svg.append("g").selectAll("circle")
		.data(data).enter()
		.append("circle")
		.attr("cx", function (d) {return projection([d.newlongitude,d.newlatitude])[0]; })
		.attr("cy", function (d) { return projection([d.newlongitude,d.newlatitude])[1]; })
		.attr("r", 3)
		.attr("fill", function (d) {
			var color=''
			for (var item in couleur) {
				if(couleur[item]['Cat']==d.Disaster_type.trim()){
				color=couleur[item]['Color']
					}
				}
			
			return color})
		.attr("fill-opacity", 0.5)
		.attr("stroke","black")
		.attr("stroke-width",0.5)
		.attr("stroke-opacity",1)
		.on("click",function(d,i){ 
		svg.append("text")
		.attr("r", 2)

		})
		.on("mouseover", function(d,i){ 
			if(d3.select(this).style("opacity")>=0.5){
				
          d3.select(this)
          .attr("fill-opacity", 1)
          .attr("stroke-width",1)
          .attr("r", 7);
          }
          
          if(projection([d.newlongitude,d.newlatitude])[0] <="750"){
          svg.append('rect')
          	.attr("x",projection([d.newlongitude,d.newlatitude])[0] +5)
          	.attr("y",projection([d.newlongitude,d.newlatitude])[1]-20 )  
            .attr('width', 260)
            .attr('height', 110)
          	.style('fill', "white")
            .style('stroke', "black");
         svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] +10)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] )             
          .text("Disaster type : " + d.Disaster_type)
          svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] +10)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +20)             
          .text("Disaster subtype : " + d.Disaster_subtype)
         svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] +10)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +40)             
          .text("Country : " + d.newcountry)
          svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] +10)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +60)             
          .text("Year : " + d.year)
          svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] +10)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +80)             
          .text("Number of casualties: " + parseInt(d.Total_deaths))}

          if(projection([d.newlongitude,d.newlatitude])[0] >"750"){
          svg.append('rect')
          	.attr("x",projection([d.newlongitude,d.newlatitude])[0] -265)
          	.attr("y",projection([d.newlongitude,d.newlatitude])[1]-20 )  
            .attr('width', 260)
            .attr('height', 110)
          	.style('fill', "white")
            .style('stroke', "black");
         svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] -260)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] )             
          .text("Disaster type : " + d.Disaster_type)
          svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] -260)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +20)             
          .text("Disaster subtype : " + d.Disaster_subtype)
         svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] -260)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +40)             
          .text("Country : " + d.newcountry)
          svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] -260)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +60)             
          .text("Year : " + d.year)
          svg.append("text")
          .attr("x",projection([d.newlongitude,d.newlatitude])[0] -260)
          .attr("y",projection([d.newlongitude,d.newlatitude])[1] +80)             
          .text("Number of casualties: " + parseInt(d.Total_deaths))}

			
    })
    .on("mouseout", function(d) {
    	if(d3.select(this).style("opacity")>=0.8){
    		
    		d3.select(this).attr("fill-opacity", 0.5)
    		.attr("stroke-width",0.5)
          .attr("r", 3)
    		filterpoints()
    	
    	}
    	 d3.selectAll("rect").remove();
    	 d3.selectAll("text").remove();
    })
      })
      })
    })

    function change(event,elm){
			if(event.target.style.border!=''){
			event.target.style.border="";
			event.target.style.borderRadius="0";
			}
			else{
				event.target.style.border="3px solid #8bc34a";
				event.target.style.borderRadius="50%";
			}
			filterpoints()
			
			
		}
	
	//function to select points base on user choice (region, period of time and type of catnat)
	function filterpoints(){
		//coordonnes continent
		coord=[[-100,35,380,'North America'],[5,48,750,'Europe'],[0,0,340,'Africa'],
			[-80,-20,320,'South America'],[60,20,320,'Asia'],[110,-10,305,'Oceania']]
		//récupération des options de filtrage active
		optionstype=document.getElementsByClassName('typecat')
		optiontypeactive=[]
		for (var i = 0; i < optionstype.length; i++) {
			    
			    if(optionstype[i].style.border!=''){
			    	optiontypeactive.push(optionstype[i].name)
			    }
			}
		zonegeo=document.getElementsByClassName('typecont')
		zonegeoactive=[]
		coordactive=[]
		for (var i = 0; i < zonegeo.length; i++) {
		    
		    if(zonegeo[i].style.border!=''){
		    	zonegeoactive.push(zonegeo[i].name)
		    	for (var j = 0; j < coord.length; j++) {
			    		if(zonegeo[i].name==coord[j][3]){
			    			coordactive.push(coord[j])
			    		}
			    	}
		    }
		}
		
		//debut du filtrage
		//on met tous les cercles en petits et presque transparent
		svg.selectAll("circle")
				.attr("fill-opacity", 0.2)
				.attr("stroke-opacity",0.7)
				.attr("stroke-width",0.5)
				.attr("r", 3)
		if(zonegeoactive.length==0 && optiontypeactive.length>0){
			//centrage carte monde
			path = path.projection(projection.center([-20,20]).scale(220));
					svg.selectAll("path")
						.transition()
				      	.duration(0)
				      	.attr("d", path);
			for (var i = 0; i < optiontypeactive.length; i++) {
				
				svg.selectAll("circle")
				.filter(function(d) { return d.Disaster_type == optiontypeactive[i] })
				.attr("fill-opacity", 0.5)
				.attr("stroke-opacity",1)
				.attr("r", 4)
				
				
				
			}
		}
		if(optiontypeactive.length==0 && zonegeoactive.length>0){
			coord=barycentre(coordactive)
			path = path.projection(projection.center([coord[0], coord[1]]).scale(coord[2]));
					svg.selectAll("path")
						.transition()
				      	.duration(0)
				      	.attr("d", path);
			for (var i = 0; i < zonegeoactive.length; i++) {
				svg.selectAll("circle")
				.filter(function(d) { return (d.continent == zonegeoactive[i])})
				.attr("fill-opacity", 0.8)
					.attr("stroke-width",1)
					.attr("stroke-opacity",1)
				.attr("r", 5)
			}
		}
		if(optiontypeactive.length>0 && zonegeoactive.length>0){
			coord=barycentre(coordactive)
			path = path.projection(projection.center([coord[0], coord[1]]).scale(coord[2]));
					svg.selectAll("path")
						.transition()
				      	.duration(0)
				      	.attr("d", path);
					//console.log(optiontypeactive);
			for (var i = 0; i < zonegeoactive.length; i++) {
				for (var j = 0; j < optiontypeactive.length; j++) {
					
					svg.selectAll("circle")
					.filter(function(d) { return (d.Disaster_type == optiontypeactive[j] && d.continent == zonegeoactive[i])})
					.attr("fill-opacity", 0.9)
					.attr("stroke-width",1)
					.attr("stroke-opacity",1)
					.attr("r", 6)
				}
			}
		}
		if(zonegeoactive.length==0 && optiontypeactive.length==0){
			//centrage carte monde
			path = path.projection(projection.center([-20, 20]).scale(220));
					svg.selectAll("path")
						.transition()
				      	.duration(0)
				      	.attr("d", path);
				//console.log(optiontypeactive[i]);
				svg.selectAll("circle")
				.attr("fill-opacity", 0.5)
				.attr("stroke-opacity",1)
				.attr("r", 3)
			
		}
		svg.selectAll("circle")
		.filter(function(d) { return (d.year < debut || d.year > fin)})
		.attr("fill-opacity", 0)
		.attr("stroke-opacity", 0)
		.attr("r", 2)

		svg.selectAll("circle")
		.attr("cx", function (d) {return projection([d.newlongitude,d.newlatitude])[0]; })
		.attr("cy", function (d) { return projection([d.newlongitude,d.newlatitude])[1]; })
		
		update_number()
	}
	
	function update_number(){

		d3.csv("https://raw.githubusercontent.com/glegall7/datavizCATNAT/master/test6.csv", function(data){
		
		var prenested =data.filter(function(d) { return (d.year >= debut && d.year <= fin)})

		var nested_data_type = d3.nest()
			.key(function(d) { return d.Disaster_type; })
			.rollup(function(leaves) { return leaves.length; })
			.entries(prenested)
		console.log(nested_data_type);

		var data_drought= document.getElementById("data_drought")
		data_drought.innerHTML = 'Drought : ';

		var data_earthquake= document.getElementById("data_earthquake")
		data_earthquake.innerHTML = 'Earthquake : ' + nested_data_type[0].value;

		var data_storm= document.getElementById("data_storm")
		data_storm.innerHTML = 'Storms : ' + nested_data_type[1].value;

		var data_volcanic= document.getElementById("data_volcanic")
		data_volcanic.innerHTML = 'Volcanic activities : ' + nested_data_type[3].value;

		var data_wildfire= document.getElementById("data_wildfire")
		data_wildfire.innerHTML = 'Wildfires : ' + nested_data_type[4].value;

		var data_dry= document.getElementById("data_dry")
		data_dry.innerHTML = 'Extreme Temperatures : ' + nested_data_type[5].value;

		var nested_data_continent = d3.nest()
			.key(function(d) { return d.continent; })
			.rollup(function(leaves) { return leaves.length; })
			.entries(prenested)
		

		var data_asia= document.getElementById("data_asia")
		data_asia.innerHTML = 'Asia : ' + nested_data_continent[0].value;

		var data_north_am= document.getElementById("data_north_am")
		data_north_am.innerHTML = 'North America : ' + nested_data_continent[1].value;

		var data_europe= document.getElementById("data_europe")
		data_europe.innerHTML = 'Europe : ' + nested_data_continent[3].value;

		var data_south_am= document.getElementById("data_south_am")
		data_south_am.innerHTML = 'South America : ' + nested_data_continent[4].value;

		var data_africa= document.getElementById("data_africa")
		data_africa.innerHTML = 'Africa : ' + nested_data_continent[5].value;

		var data_oceania= document.getElementById("data_oceania")
		data_oceania.innerHTML = 'Oceania : ' + nested_data_continent[6].value;
	})

	}
	
	
	function filterlinegraph(){
		var interval=2020-1900
		var debutpourc=String((debut-1900)/interval*100)+'%'
		var debutpourc2=String((debut-1900)/interval*100+1)+'%'
		var finpourc2=String(100-(2020-fin)/interval*100-1)+'%'
		var finpourc=String(100-(2020-fin)/interval*100)+'%'
		gradient.selectAll("stop").remove()
		datagradient=[                             
	        {offset: "0%", color: "grey"}, 
	        {offset: debutpourc, color: "grey"}, 
	        {offset: debutpourc2, color: "red"},
	        {offset: finpourc2, color: "red"},
	        {offset: finpourc, color: "grey"}, 
	        {offset: "100%", color: "grey"}
	    ]
		gradient.selectAll("stop")                      
	    .data(datagradient)                  
		.enter().append("stop")         
	    .attr("offset", function(d) { return d.offset; })   
	    .attr("stop-color", function(d) { return d.color; });
	}
	
	function barycentre(listecoord){
		lat=0
		longi=0
		scale=1000
		if(listecoord.length>2){
			return [0,0,180]
		}
		for (var i = 0; i < listecoord.length; i++) {
			lat=lat+listecoord[i][0]
			longi=longi+listecoord[i][1]
			scale=Math.min(scale,listecoord[i][2])
		}
		return [lat/listecoord.length, longi/listecoord.length, scale/Math.sqrt(listecoord.length)]
	}
	function zoom(a,b,c,continent){
				
		filterpoints()
	}

	
	filterpoints()

	function update_number(debut,fin){

		d3.csv("https://raw.githubusercontent.com/glegall7/datavizCATNAT/master/test6.csv", function(data){

		var prenested =data.filter(function(d) { return (d.year >= debut && d.year <= fin)})

		var nested_data_type = d3.nest()
			.key(function(d) { return d.Disaster_type; })
			.rollup(function(leaves) { return leaves.length; })
			.entries(data)
		console.log(nested_data_type);

		var data_drought= document.getElementById("data_drought")
		data_drought.innerHTML = 'Drought : ';

		var data_earthquake= document.getElementById("data_earthquake")
		data_earthquake.innerHTML = 'Earthquake : ' + nested_data_type[0].value;

		var data_storm= document.getElementById("data_storm")
		data_storm.innerHTML = 'Storms : ' + nested_data_type[1].value;

		var data_volcanic= document.getElementById("data_volcanic")
		data_volcanic.innerHTML = 'Volcanic activities : ' + nested_data_type[3].value;

		var data_wildfire= document.getElementById("data_wildfire")
		data_wildfire.innerHTML = 'Wildfires : ' + nested_data_type[4].value;

		var data_dry= document.getElementById("data_dry")
		data_dry.innerHTML = 'Extreme Temperatures : ' + nested_data_type[5].value;

		var nested_data_continent = d3.nest()
			.key(function(d) { return d.continent; })
			.rollup(function(leaves) { return leaves.length; })
			.entries(data)
		console.log(nested_data_continent);

		var data_asia= document.getElementById("data_asia")
		data_asia.innerHTML = 'Asia : ' + nested_data_continent[0].value;

		var data_north_am= document.getElementById("data_north_am")
		data_north_am.innerHTML = 'North America : ' + nested_data_continent[1].value;

		var data_europe= document.getElementById("data_europe")
		data_europe.innerHTML = 'Europe : ' + nested_data_continent[3].value;

		var data_south_am= document.getElementById("data_south_am")
		data_south_am.innerHTML = 'South America : ' + nested_data_continent[4].value;

		var data_africa= document.getElementById("data_africa")
		data_africa.innerHTML = 'Africa : ' + nested_data_continent[5].value;

		var data_oceania= document.getElementById("data_oceania")
		data_oceania.innerHTML = 'Oceania : ' + nested_data_continent[6].value;
	})

	}
  </script>
  <style>
  	svg { display: block;
  	width:100%}
  	g { 
  	width:100%}
  	.main{height:800px}
  	
  	#selectpanel{
  	background-color:rgba(240,240,240,0.7);
  	padding-top:10px;
  	padding-left:20px;
  	position:absolute;
  	bottom:0;
  	margin-bottom:0;
  	
  	}
  	
	#disasterpanel{
  	position:absolute;
  	left:0;
	top:0;
  	margin-bottom:0;
  	padding:0;
  	}
  	
  	#buttondisaster{
  	
	width:30px;
  	}
  	
  	#continentpanel{
  	position:absolute;
  	right:0;
	top:0;
  	margin-bottom:0;
  	padding:0;
  	}
  	
  	#buttoncontinent{
  	
	width:40px;
  	}

	.button{
		margin-top : 10px;
		margin-bottom : 10px;
		height:40px;
	}
	
	.button2{
		margin-top : 10px;
		margin-bottom : 10px;
		height:40px;
	}

  	#onoff{
  		position:relative;
  		background-color:none;
  		top:-38px;
  		width:28px;
  		height:28px;
  		left:50%
  	}
  	
  	#line {                         
    fill: none;                 
    stroke: url(#line-gradient);    
    stroke-width: 2px;          
}
.detailstype
{
	position:relative;
	left:0;
	top:-41px;
	padding-left:45px;
	height:41px;
	color:white;
	font-weight:600;
	border-radius:20px;
	display:none;
}

.iconcat
{
	position:relative;
	left:0;
	z-index:1;
	border-radius: 20px;
}

.iconcont
{
	position:relative;
	left:0;
	z-index:1;
	border-radius:20px;
	background-color:grey;
}

.detailscont
{
	position:relative;
	top:-41px;
	padding-right:45px;
	height:41px;
	text-align:right;
	color:white;
	font-weight:600;
	border-radius:20px;
	display:none;
}
  </style>


    
</body>

</html>